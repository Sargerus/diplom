@model IEnumerable<WebApplication1.ViewModel.StatListViewModel>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Body{


    @*@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
        {
            @Html.AntiForgeryToken()
        }*@

    @if (Model != null)
    {

        foreach (var item in Model)
        {

            <div>
                <div class="task-label-pk row" style="margin-left:0; margin-right:0;">
                    <div class="col-sm-6 col-md-6">
                        Timesheet
                    </div>
                    <div class="col-sm-6 col-md-6 text-right" style="padding-right:0;">
                        @Html.ActionLink("Back to tasks", "Index", "ProjectTasks", new { @projectId = ViewBag.ProjectId, user = (string)ViewBag.ViewedUser }, new { @class = "btn btn-success", @style = "border-radius:15px;" })
                    </div>
                </div>
            </div>

            <div class="text-left row" style="font-size:130%;margin-top:1.5em;">
                <div class="col-sm-6">
                    <b>You are viewing:</b>@ViewBag.ViewedUser
                </div>
                <div class="col-sm-6">
                    <b>Project:&nbsp;</b>@Html.ActionLink((string)ViewBag.ProjectName, "Details", "Projects", new { @id = ViewBag.ProjectId }, new { @style = "color:black;" })
                </div>
            </div>

            <hr />

            <div class="text-right" style="padding-right:.5em;margin-bottom:1.5em;">
                @Html.ActionLink("Previous Week", "Index", "StatList", new { usersString = Json.Encode(new List<String> { (string)ViewBag.ViewedUser }), projectid = ViewBag.ProjectId, today = ViewBag.StartDayOfWeek.AddDays(-7) }, new { @class = "btn btn-success", @style = "border-radius:15px;" })
                @Html.ActionLink("Curent Week", "Index", "StatList", new { usersString = Json.Encode(new List<String> { (string)ViewBag.ViewedUser }), projectid = ViewBag.ProjectId, today = ViewBag.Today }, new { @class = "btn btn-warning", @style = "border-radius:15px;" })
                @Html.ActionLink("Next Week", "Index", "StatList", new { usersString = Json.Encode(new List<String> { (string)ViewBag.ViewedUser }), projectid = ViewBag.ProjectId, today = (DateTime)ViewBag.StartDayOfWeek.AddDays(7) }, new { @class = "btn btn-success", @style = "border-radius:15px;" })

            </div>
            @*<div class="header">
                    <div class="header-item">@item.ProjectName</div>
                    <div class="header-item">@item.UserName</div>
                </div>*@

            <div class="row col-mar">
                <div class="col-sm-5 text-center">Description</div>
                <div class="col-sm-1 text-center">Mon @ViewBag.StartDayOfWeek.ToString("dd/MM/yy")</div> @{ DateTime monday = @ViewBag.StartDayOfWeek.Date; }
                <div class="col-sm-1 text-center">Tue @ViewBag.StartDayOfWeek.AddDays(1).ToString("dd/MM/yy")</div> @{ DateTime tuesday = monday.AddDays(1).Date; }
                <div class="col-sm-1 text-center">Wen @ViewBag.StartDayOfWeek.AddDays(2).ToString("dd/MM/yy")</div> @{ DateTime wednesday = monday.AddDays(2).Date; }
                <div class="col-sm-1 text-center">Tru @ViewBag.StartDayOfWeek.AddDays(3).ToString("dd/MM/yy")</div> @{ DateTime thursday = monday.AddDays(3).Date; }
                <div class="col-sm-1 text-center">Fri&nbsp; @ViewBag.StartDayOfWeek.AddDays(4).ToString("dd/MM/yy")</div> @{ DateTime friday = monday.AddDays(4).Date; }
                <div class="col-sm-1 text-center">Sat @ViewBag.StartDayOfWeek.AddDays(5).ToString("dd/MM/yy")</div> @{ DateTime saturday = monday.AddDays(5).Date; }
                <div class="col-sm-1 text-center">Sun @ViewBag.StartDayOfWeek.AddDays(6).ToString("dd/MM/yy")</div> @{ DateTime sunday = monday.AddDays(6).Date; }
            </div>

            if (!item.Tasks.Any())
            {
                <div class="text-center" style="margin-top:1.5em;">
                    There are no reports for user @ViewBag.ViewedUser on this week
                </div>
            }

            foreach (var task in item.Tasks)
            {
                <div class="row col-mar">
                    <div class="col-sm-5 text-left div-borders">@Html.ActionLink(task.ShortText, "Details", "ProjectTasks", new { taskid = task.TaskKey, projectid = task.ProjectKey }, null)</div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursMonday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, monday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursMonday > 0)
                        {
                            @hoursMonday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursTuesday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, tuesday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursTuesday > 0)
                        {
                            @hoursTuesday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursWednesday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, wednesday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursWednesday > 0)
                        {
                            @hoursWednesday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursThursday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, thursday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursThursday > 0)
                        {
                            @hoursThursday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursFriday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, friday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursFriday > 0)
                        {
                            @hoursFriday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursSaturday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, saturday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursSaturday > 0)
                        {
                            @hoursSaturday
                        }
                    </div>
                    <div class="col-sm-1 div-borders text-center" style="min-height:1.78em;">
                        @{ int hoursSunday = task.Reports.Where(g => DateTime.Compare(g.ReportedOn.Date, sunday) == 0).Select(g => g.HoursReported).Sum(); }
                        @if (hoursSunday > 0)
                        {
                            @hoursSunday
                        }
                    </div>
                </div>
            }
        }
    }
    <script type="text/javascript">

        //$("#unicID").click(function () {

        //    //var form = $('#__AjaxAntiForgeryForm');
        //    //var token = $('input[name="__RequestVerificationToken"]', form).val();

        //    var userIDs = ["user"];

        //    var users = JSON.stringify({ 'users': userIDs });

        //    $.post({
        //        url: "/StatList/Index",
        //        data: {
        //            //__RequestVerificationToken: token,
        //            users: userIDs,
        //            projectid: "1"
        //        },
        //        success: function (data) { $("html").html(data); }
        //    });

        //});


        @*$("#prevWeek").click(function () {

            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();

            var userIDs = ["user"];

            var users = JSON.stringify({ 'users': userIDs });

            $.post({
                url: "/StatList/Index",
                data: { users: userIDs, projectid: "1", today: "@DateTime.Now.AddDays(-7)" },
                success: function (data) { $("body").html(data); }
            });

        });


        $("#nextWeek").click(function () {

            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();

            var userIDs = ["user"];
            var date = new Date();
            date = Date.now();
            var sss = date.valueOf();
            var s1 = sss.toString();

            $.post({
                url: "/StatList/Index",
                data: { users: userIDs, projectid: "1" },
                success: function (data) { $("body").html(data); }
            });

        });*@

    </script>

}